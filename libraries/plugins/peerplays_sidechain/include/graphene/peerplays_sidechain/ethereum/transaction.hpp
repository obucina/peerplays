#pragma once

#include <cstdint>
#include <string>
#include <vector>

#include <graphene/peerplays_sidechain/ethereum/types.hpp>

namespace graphene { namespace peerplays_sidechain { namespace ethereum {

class base_transaction {
public:
   base_transaction() = default;
   base_transaction(const std::string &raw_tx);

   virtual std::string serialize() const = 0;
   virtual void deserialize(const std::string &raw_tx) = 0;
};

class transaction : base_transaction {
public:
   std::string from;
   std::string to;
   std::string data;

   transaction() = default;
   transaction(const std::string &raw_tx);

   const transaction &sign(const std::string &private_key) const;

   virtual std::string serialize() const override;
   virtual void deserialize(const std::string &raw_tx) override;
};

class signed_transaction;
class raw_transaction : base_transaction {
public:
   std::string nonce;
   std::string gas_price;
   std::string gas_limit;
   std::string to;
   std::string value;
   std::string data;
   std::string chain_id;

   raw_transaction() = default;
   raw_transaction(const std::string &raw_tx);

   bytes hash() const;
   signed_transaction sign(const std::string &private_key) const;

   virtual std::string serialize() const override;
   virtual void deserialize(const std::string &raw_tx) override;
};

class signed_transaction : base_transaction {
public:
   std::string nonce;
   std::string gas_price;
   std::string gas_limit;
   std::string to;
   std::string value;
   std::string data;
   std::string v;
   std::string r;
   std::string s;

   signed_transaction() = default;
   signed_transaction(const std::string &raw_tx);

   std::string recover(const std::string &chain_id) const;

   virtual std::string serialize() const override;
   virtual void deserialize(const std::string &raw_tx) override;
};

}}} // namespace graphene::peerplays_sidechain::ethereum

// Example 1
//{
//  "blockHash": "0x64a6706ecaf5a97b7f3e047abb20ff223ce82c6994d80e68fdb1fdfb38d0209c",
//  "blockNumber": "0xe5827c",
//  "from": "0x8614c67e085f2334010f2a28e806c6f1cc176d12",
//  "gas": "0x38822",
//  "gasPrice": "0xce42cba69",
//  "maxFeePerGas": "0xddb4d8d16",
//  "maxPriorityFeePerGas": "0x3b9aca00",
//  "hash": "0xeac92ea09fa8eb3ca2fb0d156cceb38ae69d4345869d41e8e49d5ecbcbb622dc",
//  "input": "0x5ae401dc0000000000000000000000000000000000000000000000000000000062bb57cf00000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000e4472b43f300000000000000000000000000000000000000000000000002514d9d7d7d8000000000000000000000000000000000000000000007dced93dd41fd3e1f9e80c200000000000000000000000000000000000000000000000000000000000000800000000000000000000000008614c67e085f2334010f2a28e806c6f1cc176d120000000000000000000000000000000000000000000000000000000000000002000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000000000000000000000000059c12ed5aaf25adbc6e15f9cc9bab2dde03121500000000000000000000000000000000000000000000000000000000",
//  "nonce": "0x32",
//  "to": "0x68b3465833fb72a70ecdf485e0e4c7bd8665fc45",
//  "transactionIndex": "0xb6",
//  "value": "0x2514d9d7d7d8000",
//  "type": "0x2",
//  "accessList": [],
//  "chainId": "0x1",
//  "v": "0x1",
//  "r": "0x2f8d6a9c737ed98792bafc903b8f1aa54adc731bd3cf9a8b25246a1c9095a28c",
//  "s": "0x782c40e64b47a221a07612c822c08763f626e53c4b00b73f4c5ba86304c43f14"
//}
//
//"0xf9021332850ce42cba69830388229468b3465833fb72a70ecdf485e0e4c7bd8665fc458802514d9d7d7d8000b901a45ae401dc0000000000000000000000000000000000000000000000000000000062bb57cf00000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000e4472b43f300000000000000000000000000000000000000000000000002514d9d7d7d8000000000000000000000000000000000000000000007dced93dd41fd3e1f9e80c200000000000000000000000000000000000000000000000000000000000000800000000000000000000000008614c67e085f2334010f2a28e806c6f1cc176d120000000000000000000000000000000000000000000000000000000000000002000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000000000000000000000000059c12ed5aaf25adbc6e15f9cc9bab2dde0312150000000000000000000000000000000000000000000000000000000001a02f8d6a9c737ed98792bafc903b8f1aa54adc731bd3cf9a8b25246a1c9095a28ca0782c40e64b47a221a07612c822c08763f626e53c4b00b73f4c5ba86304c43f14"
//
//{
//  "nonce": 50,
//  "gasPrice": {
//    "_hex": "0x0ce42cba69"
//  },
//  "gasLimit": {
//    "_hex": "0x038822"
//  },
//  "to": "0x68b3465833fb72a70ecdf485e0e4c7bd8665fc45",
//  "value": {
//    "_hex": "0x02514d9d7d7d8000"
//  },
//  "data": "0x5ae401dc0000000000000000000000000000000000000000000000000000000062bb57cf00000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000e4472b43f300000000000000000000000000000000000000000000000002514d9d7d7d8000000000000000000000000000000000000000000007dced93dd41fd3e1f9e80c200000000000000000000000000000000000000000000000000000000000000800000000000000000000000008614c67e085f2334010f2a28e806c6f1cc176d120000000000000000000000000000000000000000000000000000000000000002000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000000000000000000000000059c12ed5aaf25adbc6e15f9cc9bab2dde03121500000000000000000000000000000000000000000000000000000000",
//  "v": 1,
//  "r": "0x2f8d6a9c737ed98792bafc903b8f1aa54adc731bd3cf9a8b25246a1c9095a28c",
//  "s": "0x782c40e64b47a221a07612c822c08763f626e53c4b00b73f4c5ba86304c43f14"
//}

// Example 2
//{
//  "blockHash": "0xe2ae3afd86dc7343c7fb753441447a0a51bb19499325ad6e278256f0cd1b5894",
//  "blockNumber": "0xe58271",
//  "from": "0xb895ade6d337fbb8cb97f2ea7da43106c7f5cc26",
//  "gas": "0x5208",
//  "gasPrice": "0xe6f3b322e",
//  "maxFeePerGas": "0x1322455fd3",
//  "maxPriorityFeePerGas": "0x53724e00",
//  "hash": "0xed29b56e52ad2d452e25b8ec70c37f59d935cd6d0f8fe8e83b256f3ffdfd3fce",
//  "input": "0x",
//  "nonce": "0x37",
//  "to": "0x176386b6ffc469ac049f9ec1f6cc0efd1d09b373",
//  "transactionIndex": "0x8a",
//  "value": "0x4563918244f40000",
//  "type": "0x2",
//  "accessList": [],
//  "chainId": "0x1",
//  "v": "0x0",
//  "r": "0xdcc588257770e08660cb809e71b293f556cd5f5323e832d96ee896ff8830ca4c",
//  "s": "0x28c7ce6a539d9318688687097a2db29e15c32ba8c085275fdd3dddf047d4bd1a"
//}
//
//"0xf86c37850e6f3b322e82520894176386b6ffc469ac049f9ec1f6cc0efd1d09b373884563918244f400008000a0dcc588257770e08660cb809e71b293f556cd5f5323e832d96ee896ff8830ca4ca028c7ce6a539d9318688687097a2db29e15c32ba8c085275fdd3dddf047d4bd1a"
//
//{
//  "nonce": 55,
//  "gasPrice": {
//    "_hex": "0x0e6f3b322e"
//  },
//  "gasLimit": {
//    "_hex": "0x5208"
//  },
//  "to": "0x176386b6ffc469ac049f9ec1f6cc0efd1d09b373",
//  "value": {
//    "_hex": "0x4563918244f40000"
//  },
//  "data": "0x",
//  "v": 0,
//  "r": "0xdcc588257770e08660cb809e71b293f556cd5f5323e832d96ee896ff8830ca4c",
//  "s": "0x28c7ce6a539d9318688687097a2db29e15c32ba8c085275fdd3dddf047d4bd1a"
//}
